
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Krushna Mens Wear</title>

<script type="module">
import { firebaseConfig } from './firebase-config.js';
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let allProducts = [];
let cart = JSON.parse(localStorage.getItem("cart")) || [];

async function loadProducts() {
  const snap = await getDocs(collection(db,"products"));
  allProducts = [];
  snap.forEach(doc => allProducts.push({id:doc.id,...doc.data()}));
  renderProducts(allProducts);
  renderCategories();
}

function renderProducts(products){
  let html="";
  products.forEach(p=>{
    html+=`
    <div class="card">
      <img src="${p.imageURL}">
      <h4>${p.name}</h4>
      <div class="price">â‚¹${p.price}</div>
      <button onclick="addToCart('${p.id}')">Add to Cart</button>
      <a href="${p.meeshoLink}" target="_blank">
        <button class="buy">Buy Now</button>
      </a>
    </div>`;
  });
  document.getElementById("products").innerHTML=html;
}

function renderCategories(){
  let cats=["All"];
  allProducts.forEach(p=>{
    if(!cats.includes(p.category)) cats.push(p.category);
  });
  let html="";
  cats.forEach(c=>{
    html+=`<button onclick="filterCategory('${c}')">${c}</button>`;
  });
  document.getElementById("categories").innerHTML=html;
}

window.filterCategory=function(cat){
  if(cat==="All"){ renderProducts(allProducts); return;}
  const filtered=allProducts.filter(p=>p.category===cat);
  renderProducts(filtered);
}

window.addToCart=function(id){
  const product=allProducts.find(p=>p.id===id);
  cart.push(product);
  localStorage.setItem("cart",JSON.stringify(cart));
  alert("Added to Cart");
}

window.openCart=function(){
  let total=0, html="";
  cart.forEach(p=>{
    total+=parseInt(p.price);
    html+=`<p>${p.name} - â‚¹${p.price}</p>`;
  });
  html+=`<hr>Total: â‚¹${total}`;
  document.getElementById("cartBox").innerHTML=html;
  document.getElementById("cartPanel").style.display="block";
}

window.onload=loadProducts;
</script>

<style>
body{font-family:Arial;margin:0;background:#f5f5f5}
header{background:#0d47a1;color:white;padding:15px;display:flex;justify-content:space-between}
button{padding:6px 10px;margin:5px;border:none;cursor:pointer}
.card{background:white;width:220px;display:inline-block;margin:10px;padding:10px;border-radius:5px;box-shadow:0 2px 6px rgba(0,0,0,0.1)}
.card img{width:100%;height:180px;object-fit:cover}
.price{color:#0d47a1;font-weight:bold}
.buy{background:#1976d2;color:white}
#cartPanel{position:fixed;right:0;top:0;width:300px;background:white;height:100%;padding:15px;display:none}
</style>
</head>

<body>
<header>
<h2>Krushna Mens Wear</h2>
<button onclick="openCart()">ðŸ›’ Cart</button>
</header>

<div id="categories" style="padding:10px;text-align:center"></div>
<div id="products" style="text-align:center"></div>

<div id="cartPanel">
<h3>Your Cart</h3>
<div id="cartBox"></div>
<button onclick="document.getElementById('cartPanel').style.display='none'">Close</button>
</div>

</body>
</html>
