
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Krushna Mens Wear</title>
<script type="module">
import { firebaseConfig } from './firebase.js';
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let products=[];
let cart=[];

async function loadProducts(){
  const snap = await getDocs(collection(db,"products"));
  products=[];
  snap.forEach(doc=>products.push({id:doc.id,...doc.data()}));
  renderProducts(products);
  renderCategories();
}

function renderCategories(){
  let cats=["All"];
  products.forEach(p=>{
    if(!cats.includes(p.category)) cats.push(p.category);
  });
  let html="";
  cats.forEach(c=>{
    html+=`<button onclick="filterCat('${c}')">${c}</button>`;
  });
  document.getElementById("categories").innerHTML=html;
}

window.filterCat=function(cat){
  if(cat==="All"){ renderProducts(products); return;}
  const filtered = products.filter(p=>p.category===cat);
  renderProducts(filtered);
}

window.searchProduct=function(){
  const val = document.getElementById("search").value.toLowerCase();
  const filtered = products.filter(p=>p.name.toLowerCase().includes(val));
  renderProducts(filtered);
}

function renderProducts(list){
  let html="";
  list.forEach(p=>{
    html+=`
    <div class="card">
      <img src="${p.image}" width="150"><br>
      <b>${p.name}</b><br>
      ₹${p.discountPrice} <span class="old">₹${p.price}</span><br>
      ⭐ ${p.rating}<br>
      <button onclick="addToCart('${p.id}')">Add</button>
      <a href="${p.meesho}" target="_blank"><button>Buy</button></a>
    </div>`;
  });
  document.getElementById("products").innerHTML=html;
}

window.addToCart=function(id){
  const item = products.find(p=>p.id===id);
  const existing = cart.find(p=>p.id===id);
  if(existing){ existing.qty +=1; }
  else{ cart.push({...item, qty:1}); }
  renderCart();
}

function renderCart(){
  let total=0, html="";
  cart.forEach((p,i)=>{
    total+=p.qty * parseInt(p.discountPrice);
    html+=`<p>${p.name} x${p.qty} - ₹${p.qty * p.discountPrice}
    <button onclick="removeItem(${i})">X</button></p>`;
  });
  html+=`<hr>Total: ₹${total}
  <button onclick="placeOrder()">Place Order</button>`;
  document.getElementById("cart").innerHTML=html;
}

window.removeItem=function(i){
  cart.splice(i,1);
  renderCart();
}

window.placeOrder=async function(){
  const customerName = prompt("Enter your name:");
  const customerMobile = prompt("Enter your mobile number:");
  await addDoc(collection(db,"orders"),{
    customerName:customerName,
    customerMobile:customerMobile,
    items:cart,
    createdAt:new Date()
  });
  alert("Order Placed Successfully!");
  cart=[];
  renderCart();
}

window.onload=loadProducts;
</script>
<style>
body{font-family:Arial;background:#f5f5f5;text-align:center}
header{background:#0d47a1;color:white;padding:15px}
.card{background:white;display:inline-block;padding:10px;margin:10px;border-radius:5px;width:220px}
button{padding:6px 12px;margin:5px;background:#0d47a1;color:white;border:none}
.old{text-decoration:line-through;color:red;font-size:12px}
#cartBox{position:fixed;right:0;top:0;width:260px;height:100%;background:white;padding:10px;overflow:auto}
</style>
</head>
<body>
<header>Krushna Mens Wear</header>
<input id="search" placeholder="Search product" onkeyup="searchProduct()"><br>
<div id="categories"></div>
<div id="products"></div>
<div id="cartBox">
<h3>Cart</h3>
<div id="cart"></div>
</div>
</body>
</html>
