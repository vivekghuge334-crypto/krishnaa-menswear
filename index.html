
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Krushna Mens Wear</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, collection, addDoc, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB9gYDFOtNuoy_xDtZAB8VhqO_SYBs2kUQ",
  authDomain: "krushnamenswear009.firebaseapp.com",
  projectId: "krushnamenswear009"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.signup = async function(){
  const email = emailInput.value;
  const pass = passwordInput.value;

  const userCred = await createUserWithEmailAndPassword(auth,email,pass);
  await sendEmailVerification(userCred.user);
  await setDoc(doc(db,"users",userCred.user.uid),{role:"user"});
  alert("Verification email sent. Please verify first.");
}

window.login = async function(){
  const email = emailInput.value;
  const pass = passwordInput.value;

  const userCred = await signInWithEmailAndPassword(auth,email,pass);

  if(!userCred.user.emailVerified){
    alert("Verify email first");
    return;
  }

  const snap = await getDoc(doc(db,"users",userCred.user.uid));
  const role = snap.data().role;

  loginSection.style.display="none";

  if(role==="admin"){
    adminSection.style.display="block";
    loadProducts();
  }else{
    shopSection.style.display="block";
    loadProducts();
  }
}

window.logout = async function(){
  await signOut(auth);
  location.reload();
}

async function loadProducts(){
  const snap = await getDocs(collection(db,"products"));
  let html="";
  snap.forEach(doc=>{
    const p = doc.data();
    html+=`
    <div class="card">
      <img src="${p.imageURL}" width="150"><br>
      <b>${p.name}</b><br>
      â‚¹${p.price}<br>
      <a href="${p.meeshoLink}" target="_blank">
      <button>Buy Now</button></a>
    </div>`;
  });
  products.innerHTML=html;
}

window.addProduct = async function(){
  await addDoc(collection(db,"products"),{
    name:pname.value,
    price:pprice.value,
    meeshoLink:plink.value,
    imageURL:pimage.value
  });
  alert("Product Added");
  loadProducts();
}

window.deleteProduct = async function(id){
  await deleteDoc(doc(db,"products",id));
  loadProducts();
}
</script>

<style>
body{font-family:Arial;background:#f5f5f5;text-align:center;margin:0}
header{background:#0d47a1;color:white;padding:15px}
input{padding:8px;margin:5px;width:250px}
button{padding:6px 12px;margin:5px;background:#0d47a1;color:white;border:none;cursor:pointer}
.card{background:white;display:inline-block;padding:10px;margin:10px;border-radius:5px}
.section{display:none;margin-top:20px}
</style>
</head>

<body>

<header><h2>Krushna Mens Wear</h2></header>

<!-- LOGIN SECTION -->
<div id="loginSection" class="section" style="display:block;">
<h3>Login / Sign Up</h3>
<input id="emailInput" placeholder="Email"><br>
<input id="passwordInput" type="password" placeholder="Password"><br>
<button onclick="login()">Login</button>
<button onclick="signup()">Sign Up</button>
</div>

<!-- SHOP SECTION -->
<div id="shopSection" class="section">
<h3>Products</h3>
<button onclick="logout()">Logout</button>
<div id="products"></div>
</div>

<!-- ADMIN SECTION -->
<div id="adminSection" class="section">
<h3>Admin Panel</h3>
<button onclick="logout()">Logout</button>
<h4>Add Product</h4>
<input id="pname" placeholder="Product Name"><br>
<input id="pprice" placeholder="Price"><br>
<input id="plink" placeholder="Meesho Link"><br>
<input id="pimage" placeholder="Image URL"><br>
<button onclick="addProduct()">Add Product</button>
<hr>
<div id="products"></div>
</div>

</body>
</html>
